---
layout: post
title: go1.18 memo
date: 2022-03-16
Author: Waken
tags: [go]
comments: true
toc: true
---

# Table of Contents

1.  [Mar 16](#org3465eb1)
    1.  [Generic types support](#org1fb880a)
    2.  [Fuzz is build-in support](#org89645d3)
    3.  [workspace is supported](#orgaf22b1d)



<a id="org3465eb1"></a>

# Mar 16

Go 1.18 [released](https://go.dev/blog/go1.18)


<a id="org1fb880a"></a>

## Generic types support

[tutorial](https://go.dev/doc/tutorial/generics)

    func Foo[K comparable, C int32 | float32] (m map[K]C, args... any) C {
    	//code
    }

-   new declarations: any, comparable type constraint for type arguments
-   new operator: ~ for type declaration


<a id="org89645d3"></a>

## Fuzz is build-in support

[tutorial](https://go.dev/doc/tutorial/fuzz)
fuzzTest generate random test input cases to fuzzTarget func

    go test -fuzz=Fuzz -fuzztime 10s (-run=xxx)

****fuzzTest run forever by default, need -fuzztime option****

    func FuzzReverse(f *testing.F) {
    	testcases := []string{"Hello, world", " ", "!12345"}
    	for _, tc := range testcases {
    		f.Add(tc) // Use f.Add to provide a seed corpus
    	}
    
    	f.Fuzz(func(t *testing.T, orig string) {
    		rev, revErr := Reverse(orig)
    		if revErr != nil {
    			t.Skip(revErr)
    		}
    		doubleRev, dRevErr := Reverse(rev)
    		if dRevErr != nil {
    			t.Skip(revErr)
    		}
    		t.Logf("Number of runes: orig=%d, rev=%d, doubleRev=%d", utf8.RuneCountInString(orig), utf8.RuneCountInString(rev), utf8.RuneCountInString(doubleRev))
    		if orig != doubleRev {
    			t.Errorf("Before: %q, after: %q", orig, doubleRev)
    		}
    		if utf8.ValidString(orig) && !utf8.ValidString(rev) {
    			t.Errorf("Reverse produced invalid UTF-8 string %q", rev)
    		}
    	})
    }


<a id="orgaf22b1d"></a>

## workspace is supported

[tutorial](https://go.dev/doc/tutorial/workspaces)
在module的上级目录run: go work init xx, 生成go.work，定义本地module，取代了 go.mod中的 go version 和 package redirect.

